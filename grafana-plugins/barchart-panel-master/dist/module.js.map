{"version":3,"sources":["../src/module.js"],"names":["_","MetricsPanelCtrl","kbn","TimeSeries","legend","$","BarChartCtrl","$scope","$injector","$rootScope","panelDefaults","show","values","links","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendTable","aliasColors","format","valueName","yaxis","label","tickDecimals","xaxis","decimals","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","value","render","series","data","parseSeries","map","serie","i","alias","flotpairs","color","colors","dataList","seriesHandler","seriesData","datapoints","target","getFlotPairs","isNumber","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","scope","elem","attrs","ctrl","find","$tooltip","renderingCompleted","setElementHeight","height","row","isString","parseInt","replace","title","css","e","processOffsetHook","plot","gridMargin","left","right","drawHook","yaxisLabel","text","appendTo","style","marginTop","addBarChart","width","min","plotCanvas","plotCss","top","margin","position","$panelContainer","parents","backgroundColor","html","plotSeries","plotTicks","origData","push","bars","align","fill","barWidth","zero","lineWidth","ticks","options","hooks","draw","processOffset","tickFormatter","val","axis","formatValue","shadowSize","grid","minBorderMargin","markings","borderWidth","hoverable","selection","mode","event","pos","item","detach","body","formatted","place_tt","pageX","pageY","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import _ from \"lodash\";\r\nimport {MetricsPanelCtrl} from \"app/plugins/sdk\";\r\nimport kbn from \"app/core/utils/kbn\";\r\nimport TimeSeries from \"app/core/time_series\";\r\nimport legend from './legend';\r\nimport './barchart-panel.css!';\r\nimport $ from \"jquery\";\r\nimport \"jquery.flot\";\r\n\r\nexport class BarChartCtrl extends MetricsPanelCtrl {\r\n\r\n    constructor($scope, $injector, $rootScope) {\r\n        super($scope, $injector);\r\n        this.$rootScope = $rootScope;\r\n\r\n        var panelDefaults = {\r\n            legend: {\r\n                show: true, // disable/enable legend\r\n                values: true\r\n            },\r\n            links: [],\r\n            datasource: null,\r\n            maxDataPoints: 3,\r\n            interval: null,\r\n            targets: [{}],\r\n            cacheTimeout: null,\r\n            nullPointMode: 'connected',\r\n            legendTable: false,\r\n            aliasColors: {},\r\n            format: 'short',\r\n            valueName: 'current',\r\n            yaxis: {\r\n                label: null,\r\n                show: true,\r\n                tickDecimals: 2\r\n            },\r\n            xaxis: {\r\n                show: true\r\n            },\r\n            decimals: 2\r\n        };\r\n\r\n        _.defaults(this.panel, panelDefaults);\r\n        _.defaults(this.panel.legend, panelDefaults.legend);\r\n\r\n        this.events.on('render', this.onRender.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-error', this.onDataError.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Axes', 'public/plugins/grafana-barchart-panel/axes.html');\r\n        this.addEditorTab('Options', 'public/plugins/grafana-barchart-panel/editor.html');\r\n        this.unitFormats = kbn.getUnitFormats();\r\n    }\r\n\r\n    setUnitFormat(subItem) {\r\n        this.panel.format = subItem.value;\r\n        this.render();\r\n    }\r\n\r\n    onDataError() {\r\n        this.series = [];\r\n        this.render();\r\n    }\r\n\r\n    onRender() {\r\n        this.data = this.parseSeries(this.series);\r\n    }\r\n\r\n    parseSeries(series) {\r\n        return _.map(this.series, (serie, i) => {\r\n            return {\r\n                label: serie.alias,\r\n                data: serie.flotpairs[0],\r\n                color: this.panel.aliasColors[serie.alias] || this.$rootScope.colors[i]\r\n            };\r\n        });\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        this.series = dataList.map(this.seriesHandler.bind(this));\r\n        this.data = this.parseSeries(this.series);\r\n        this.render(this.data);\r\n    }\r\n\r\n    seriesHandler(seriesData) {\r\n        var series = new TimeSeries({\r\n            datapoints: seriesData.datapoints,\r\n            alias: seriesData.target\r\n        });\r\n\r\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n\r\n        return series;\r\n    }\r\n\r\n    getDecimalsForValue(value) {\r\n        if (_.isNumber(this.panel.decimals)) {\r\n            return {decimals: this.panel.decimals, scaledDecimals: null};\r\n        }\r\n\r\n        var delta = value / 2;\r\n        var dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\r\n        var magn = Math.pow(10, -dec);\r\n        var norm = delta / magn; // norm is between 1.0 and 10.0\r\n        var size;\r\n\r\n        if (norm < 1.5) {\r\n            size = 1;\r\n        } else if (norm < 3) {\r\n            size = 2;\r\n            // special case for 2.5, requires an extra decimal\r\n            if (norm > 2.25) {\r\n                size = 2.5;\r\n                ++dec;\r\n            }\r\n        } else if (norm < 7.5) {\r\n            size = 5;\r\n        } else {\r\n            size = 10;\r\n        }\r\n\r\n        size *= magn;\r\n\r\n        // reduce starting decimals if not needed\r\n        if (Math.floor(value) === value) {\r\n            dec = 0;\r\n        }\r\n\r\n        var result = {};\r\n        result.decimals = Math.max(0, dec);\r\n        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\r\n        return result;\r\n    }\r\n\r\n    formatValue(value) {\r\n        var decimalInfo = this.getDecimalsForValue(value);\r\n        var formatFunc = kbn.valueFormats[this.panel.format];\r\n        if (formatFunc) {\r\n            return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n        }\r\n        return value;\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        var data, panel;\r\n\r\n        elem = elem.find('.barchart-panel');\r\n        var $tooltip = $('<div id=\"tooltip\">');\r\n\r\n        ctrl.events.on('render', function () {\r\n            render();\r\n            ctrl.renderingCompleted();\r\n        });\r\n\r\n        function setElementHeight() {\r\n            try {\r\n                var height = ctrl.height || panel.height || ctrl.row.height;\r\n                if (_.isString(height)) {\r\n                    height = parseInt(height.replace('px', ''), 10);\r\n                }\r\n\r\n                height -= 5; // padding\r\n                height -= panel.title ? 24 : 9; // subtract panel title bar\r\n\r\n                elem.css('height', height + 'px');\r\n\r\n                return true;\r\n            } catch (e) { // IE throws errors sometimes\r\n                return false;\r\n            }\r\n        }\r\n\r\n        function processOffsetHook(plot, gridMargin) {\r\n            var left = panel.yaxis;\r\n            var right = panel.yaxis;\r\n            if (left.show && left.label) { gridMargin.left = 20; }\r\n            if (right.show && right.label) { gridMargin.right = 20; }\r\n        }\r\n\r\n        function drawHook(plot) {\r\n             // add left axis labels\r\n            if (panel.yaxis.label) {\r\n                var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\r\n                    .text(panel.yaxis.label)\r\n                    .appendTo(elem);\r\n\r\n                yaxisLabel[0].style.marginTop = (elem.height() / 6) + 'px';\r\n            }\r\n        }\r\n\r\n        function addBarChart() {\r\n            var width = elem.width();\r\n            var height = elem.height();\r\n\r\n            var size = Math.min(width, height);\r\n\r\n            var plotCanvas = $('<div></div>');\r\n            var plotCss = {\r\n                top: '10px',\r\n                margin: 'auto',\r\n                position: 'relative',\r\n                height: (size - 20) + 'px'\r\n            };\r\n\r\n            plotCanvas.css(plotCss);\r\n\r\n            var $panelContainer = elem.parents('.panel-container');\r\n            var backgroundColor = $panelContainer.css('background-color');\r\n\r\n            elem.html(plotCanvas);\r\n\r\n            var plotSeries = [];\r\n            var plotTicks = [];\r\n            _.map(data, function(origData, i) {\r\n                plotSeries.push({\r\n                                    label: origData.label,\r\n                                    data: [[\r\n                                        i,\r\n                                        origData.data[1]\r\n                                    ]],\r\n                                    color: origData.color,\r\n                                    bars: {\r\n                                        show: true,\r\n                                        align: 'center',\r\n                                        fill: 1,\r\n                                        barWidth: 0.7,\r\n                                        zero: true,\r\n                                        lineWidth: 0\r\n                                    },\r\n                                    xaxis: {\r\n                                        ticks: [i, origData.label]\r\n                                    }\r\n                                });\r\n                plotTicks.push([\r\n                                   i,\r\n                                   origData.label\r\n                               ]);\r\n            });\r\n\r\n            var options = {\r\n                hooks: {\r\n                    draw: [drawHook],\r\n                    processOffset: [processOffsetHook],\r\n                },\r\n                legend: {\r\n                    show: false\r\n                },\r\n                xaxis: {\r\n                    ticks: plotTicks,\r\n                    show: panel.xaxis.show\r\n                },\r\n                yaxis: {\r\n                    show: panel.yaxis.show,\r\n                    tickFormatter: function (val, axis) {\r\n                        return ctrl.formatValue(val);\r\n                    }\r\n                },\r\n                shadowSize: 0,\r\n                grid: {\r\n                    minBorderMargin: 0,\r\n                    markings: [],\r\n                    backgroundColor: backgroundColor,\r\n                    borderWidth: 0,\r\n                    hoverable: true,\r\n                    color: '#c8c8c8',\r\n                    margin: {left: 0, right: 0},\r\n                },\r\n                selection: {\r\n                    mode: \"x\",\r\n                    color: '#666'\r\n                }\r\n            };\r\n\r\n            $.plot(plotCanvas, plotSeries, options);\r\n            plotCanvas.bind(\"plothover\", function (event, pos, item) {\r\n                if (!item) {\r\n                    $tooltip.detach();\r\n                    return;\r\n                }\r\n\r\n                var body;\r\n                var formatted = ctrl.formatValue(item.series.data[0][1]);\r\n\r\n                body = '<div class=\"graph-tooltip-small\"><div class=\"graph-tooltip-time\">';\r\n                body += '<div class=\"graph-tooltip-value\">' + item.series.label + ': ' + formatted;\r\n                body += '</div>';\r\n                body += \"</div></div>\";\r\n                $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\r\n            });\r\n        }\r\n\r\n\r\n        function render() {\r\n            if (!ctrl.data) {\r\n                return;\r\n            }\r\n\r\n            data = ctrl.data;\r\n            panel = ctrl.panel;\r\n\r\n            if (setElementHeight()) {\r\n                addBarChart();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nBarChartCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n    BarChartCtrl as PanelCtrl\r\n};\r\n\r\n"]}