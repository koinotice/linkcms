{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","panel","htmlelem","getElementsByClassName","find","plotCanvas","htmlnode","htmlShadow","events","on","render","renderingCompleted","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","formatter","label","slice","fontSize","color","Math","round","percent","addHTML","shadowRoot","attachShadow","mode","innerHTML","css_data","html_data","resizePlotCanvas","width","size","min","plotCss","top","margin","position","getAttribute","removeAttribute","initialized","doInit","handleMetric","$"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var panel;\n  var htmlelem = elem[0].getElementsByClassName('html-object')[0];\n  elem = elem.find('.html-panel');\n  var plotCanvas = elem.find('.plot-canvas');\n  var htmlnode;\n  var htmlShadow;\n\n  ctrl.events.on('render', function() {\n    render();\n    ctrl.renderingCompleted();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n  function formatter(label, slice) {\n    return \"<div style='font-size:\" + ctrl.panel.fontSize + \";text-align:center;padding:2px;color:\" + slice.color + \";'>\" + label + \"<br/>\" + Math.round(slice.percent) + \"%</div>\";\n  }\n\n  function addHTML() {\n    if (! htmlnode.shadowRoot) {\n       htmlnode.attachShadow({ mode: 'open'});\n    }\n    htmlnode.shadowRoot.innerHTML = \"<style>\" + panel.css_data+ \"</style>\" + panel.html_data;\n  }\n\n\n\n  function resizePlotCanvas() {\n    var width = elem.width();\n    var height = elem.height();\n\n    var size = Math.min(width, height);\n\n    var plotCss = {\n      top: '10px',\n      margin: 'auto',\n      position: 'relative',\n      height: (size) + 'px'\n    };\n    plotCanvas.css(plotCss);\n  }\n\n\n  function render() {\n    panel = ctrl.panel;\n\n    if (setElementHeight()) {\n      if (htmlelem) {\n        htmlnode = htmlelem;\n\n        if (htmlnode.getAttribute(\"name\") == 'isInitial') {\n          htmlnode.removeAttribute(\"name\");\n          ctrl.initialized = 0;\n        }\n\n        resizePlotCanvas();\n\n        if (!ctrl.initialized) {\n                addHTML();\n                panel.doInit(ctrl, htmlnode.shadowRoot);\n                ctrl.initialized = 1;\n        }\n\n        panel.handleMetric(ctrl, htmlnode.shadowRoot);\n\n        htmlnode = null;\n      }\n          else {\n        ctrl.initialized = 0;\n      }\n    }\n  }\n}\n\n"]}